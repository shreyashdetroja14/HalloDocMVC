
@{
    ViewData["Title"] = "Edit Provider";
    Layout = "~/Views/Shared/_AdminDashboardLayout.cshtml";
}

@section AddStyles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <link href="@Url.Content("~/css/requestform.css")" rel="stylesheet" type="text/css" />
    <style>
        #sig-canvas {
            border: 2px dotted #CCCCCC;
            border-radius: 15px;
            cursor: crosshair;
        }
    </style>
}

@model HalloDocServices.ViewModels.AdminViewModels.EditProviderViewModel

<div class="main">

    <partial name="_NavbarLinks"></partial>

    <div class="container-xl p-4">
        <div class=" back p-0 pb-4 d-flex justify-content-between">
            <h2>Edit Physician Account</h2>
            <a asp-action="Index" class="btn back-btn">
                <img src="/images/backIcon.svg" alt="">
                Back
            </a>
        </div>

        <form asp-action="EditAccountInfo" class="bg-white p-4 request-form rounded-0 shadow-none">
            <input type="number" asp-for="ProviderId" hidden>
            <div class="info mb-4">
                <h4 class="mb-3">Account Information</h4>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="Username" class="form-control account-info" id="Username"
                                   placeholder="Username" readonly>
                            <label asp-for="Username">Username</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="password" asp-for="Password" class="form-control account-info" id="Password"
                                   placeholder="Password" readonly>
                            <label asp-for="Password">Password</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <select asp-for="Status" id="status-list" class="form-select p-3 account-info" asp-items="@Model.StatusList" disabled>
                                <option value="">Set a status</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class=" mb-3">
                            <select asp-for="RoleId" id="role-list" class="form-select p-3 account-info" asp-items="@Model.RoleList" disabled>
                                
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="submit d-flex justify-content-end">
                <button type="button" id="reset-pass" class="btn btn-outline-info py-2 px-3 ms-3 d-none">Reset Password</button>
                <button type="button" id="account-info-editbtn" class="btn btn-outline-info py-2 px-3 ms-3">Edit</button>
                <input type="submit" value="Save" id="account-info-save" class="btn btn-info py-2 px-3 ms-3 text-white d-none">
                <input type="reset" value="Cancel" id="account-info-cancel" class="btn cancelbtn btn-outline-danger py-2 px-3 ms-3 d-none">
            </div>
        </form>

        <form asp-action="EditPhysicianInfo" class="bg-white p-4 pt-0 request-form rounded-0 shadow-none">
            <input type="number" asp-for="ProviderId" hidden>
            <div class="info mb-4">
                <h4 class="mb-3">Physician Information</h4>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="FirstName" class="form-control physician-info" id="FirstName"
                                   placeholder="FirstName" readonly>
                            <label asp-for="FirstName">First Name</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="LastName" class="form-control physician-info" id="LastName"
                                   placeholder="LastName" readonly>
                            <label asp-for="LastName">Last Name</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="email" asp-for="Email" class="form-control physician-info" id="Email" placeholder="Email" readonly>
                            <label asp-for="Email">Email</label>
                        </div>
                    </div>
                    <div class="col-sm-6 pb-3">
                        <input type="tel" asp-for="PhoneNumber" class="form-control w-100 physician-info" id="PhoneNumber" readonly />
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="MedicalLicense" class="form-control physician-info" id="MedicalLicense" placeholder="MedicalLicense" readonly>
                            <label asp-for="MedicalLicense">Medical License</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="NPINumber" class="form-control physician-info" id="NPINumber" placeholder="NPINumber" readonly>
                            <label asp-for="NPINumber">NPI Number</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="email" asp-for="SyncEmail" class="form-control physician-info" id="SyncEmail" placeholder="SyncEmail" readonly>
                            <label asp-for="SyncEmail">Sync Email</label>
                        </div>
                    </div>
                   
                    <div class="col-sm-6 pb-3">
                        @foreach (var state in Model.StateList)
                        {
                            <div class="form-check form-check-inline">
                                <input class="form-check-input physician-info-checkbox"
                                       type="checkbox"
                                       value="@state.Value"
                                       id="region-@state.Value"
                                       name="ProviderRegions"
                                       checked="@(Model.ProviderRegions.Contains(int.Parse(state.Value)) ? "true" : false)"
                                       disabled
                                >
                                <label class="form-check-label" for="region-@state.Value">
                                    @state.Text
                                </label>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <div class="submit d-flex justify-content-end">
                <button type="button" class="btn btn-outline-info py-2 px-3 ms-3" id="physician-info-editbtn">Edit</button>
                <input type="submit" value="Save" id="physician-info-save" class="btn btn-info py-2 px-3 ms-3 text-white d-none">
                <input type="reset" value="Cancel" id="physician-info-cancel" class="btn cancelbtn btn-outline-danger py-2 px-3 ms-3 d-none">
            </div>

        </form>

        <form asp-action="EditBillingInfo" class="bg-white p-4 pt-0 request-form rounded-0 shadow-none">
            <input type="number" asp-for="ProviderId" hidden>
            <div class="info mb-4">
                <h4 class="mb-3">Mailing & Billing Information</h4>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="Address1" class="form-control billing-info" id="Address1"
                                   placeholder="Address1" readonly>
                            <label asp-for="Address1">Address 1</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="Address2" class="form-control billing-info" id="Address2"
                                   placeholder="Address2" readonly>
                            <label asp-for="Address2">Address 2</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="City" class="form-control billing-info" id="City" placeholder="City" readonly>
                            <label asp-for="City">City</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class=" mb-3">
                            <select asp-for="RegionId" id="region-list" class="form-select p-3" asp-items="@Model.StateList" disabled>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="ZipCode" class="form-control billing-info" id="ZipCode" placeholder="ZipCode" readonly>
                            <label asp-for="ZipCode">ZipCode</label>
                        </div>
                    </div>
                    <div class="col-sm-6 pb-3">
                        <input type="tel" asp-for="SecondPhoneNumber" class="form-control w-100 billing-info" id="SecondPhoneNumber" readonly />
                    </div>
                </div>
            </div>

            <div class="submit d-flex justify-content-end">
                <button type="button" id="billing-info-editbtn" class="btn btn-outline-info py-2 px-3 ms-3">Edit</button>
                <input type="submit" value="Save" id="billing-info-save" class="btn btn-info py-2 px-3 ms-3 text-white d-none">
                <input type="reset" value="Cancel" id="billing-info-cancel" class="btn cancelbtn btn-outline-danger py-2 px-3 ms-3 d-none">
            </div>

        </form>

        <form asp-action="EditProfileInfo" class="bg-white p-4 pt-0 request-form rounded-0 shadow-none" enctype="multipart/form-data">
            <input type="number" asp-for="ProviderId" hidden>
            <div class="info mb-4">
                <h4 class="mb-3">Provider Profile</h4>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="BusinessName" class="form-control profile-info" id="BusinessName"
                                   placeholder="BusinessName" readonly>
                            <label asp-for="BusinessName">Business Name</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <input type="text" asp-for="BusinessWebsite" class="form-control profile-info" id="BusinessWebsite"
                                   placeholder="BusinessWebsite" readonly>
                            <label asp-for="BusinessWebsite">Business Website</label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="input-group mb-3">
                            <input type="file" accept=".jpg,.jpeg,.png" asp-for="Photo" class="form-control px-3 py-2 file-upload profile-info-upload" id="Photo" disabled>

                            <label class="input-group-text w-100 d-flex justify-content-between p-0 rounded-3 upload-label"
                                   asp-for="Photo">
                                <span class="px-3 py-2" id="photoSpan">Select File</span>
                                <div class="btn btn-info p-3 text-white fw-bold rounded-0">
                                    <img src="/images/uploadIcon.svg" class="me-2" alt="">Upload
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="input-group mb-3">
                            <input type="file" accept=".jpg,.jpeg,.png" asp-for="Signature" class="form-control px-3 py-2 file-upload profile-info-upload" id="Signature" disabled>

                            <label class="input-group-text w-100 d-flex justify-content-between p-0 rounded-3 upload-label"
                                   asp-for="Signature">
                                <span class="px-3 py-2" id="signatureSpan">Select File</span>
                                <div class="btn btn-info p-3 text-white fw-bold rounded-0">
                                    <img src="/images/uploadIcon.svg" class="me-2" alt="">Upload
                                </div>
                            </label>
                            <button type="button" class="btn btn-outline-info mt-3 p-3 rounded-2">Create signature</button>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12">
                                        <canvas id="sig-canvas" style="width: 100%" height="160">
                                            
                                        </canvas>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-primary" id="sig-submitBtn">Submit Signature</button>
                                        <button type="button" class="btn btn-default" id="sig-clearBtn">Clear Signature</button>
                                    </div>
                                </div>
                                <br />
                                <div class="row">
                                    <div class="col-md-12">
                                        <textarea id="sig-dataUrl" class="form-control" rows="5">Data URL for your signature will go here!</textarea>
                                    </div>
                                </div>
                                <br />
                                <div class="row">
                                    <div class="col-md-12">
                                        <img id="sig-image" src="" alt="Your signature will go here!" />
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        @if (Model.SignaturePath != null)
                        {
                            <img src="@Model.SignaturePath" class="mb-3" style="height: 100px; width: 100px;" />
                        }
                        
                    </div>
                    <div class="col-12">
                        <div class="form-floating mb-3">
                            <textarea asp-for="AdminNotes" class="form-control profile-info" placeholder="Enter Symptoms" id="AdminNotes"
                                      style="height: 150px" readonly></textarea>
                            <label asp-for="AdminNotes">Admin Notes</label>
                        </div>
                    </div>
                    
                </div>
            </div>

            <div class="submit d-flex justify-content-end">
                <button type="button" id="profile-info-editbtn" class="btn btn-outline-info py-2 px-3 ms-3">Edit</button>
                <input type="submit" value="Save" id="profile-info-save" class="btn btn-info py-2 px-3 ms-3 text-white d-none">
                <input type="reset" value="Cancel" id="profile-info-cancel" class="btn cancelbtn btn-outline-danger py-2 px-3 ms-3 d-none">
            </div>

        </form>

    </div>

</div>



@section AddScript {

    <partial name="_ToastMessageScriptsPartial" />
    <script>
        (function () {
            window.requestAnimFrame = (function (callback) {
                return window.requestAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    window.oRequestAnimationFrame ||
                    window.msRequestAnimaitonFrame ||
                    function (callback) {
                        window.setTimeout(callback, 1000 / 60);
                    };
            })();

            var canvas = document.getElementById("sig-canvas");
            var ctx = canvas.getContext("2d");
            ctx.strokeStyle = "#222222";
            ctx.lineWidth = 4;

            var drawing = false;
            var mousePos = {
                x: 0,
                y: 0
            };
            var lastPos = mousePos;

            canvas.addEventListener("mousedown", function (e) {
                drawing = true;
                lastPos = getMousePos(canvas, e);
            }, false);

            canvas.addEventListener("mouseup", function (e) {
                drawing = false;
            }, false);

            canvas.addEventListener("mousemove", function (e) {
                mousePos = getMousePos(canvas, e);
            }, false);

            // Add touch event support for mobile
            canvas.addEventListener("touchstart", function (e) {

            }, false);

            canvas.addEventListener("touchmove", function (e) {
                var touch = e.touches[0];
                var me = new MouseEvent("mousemove", {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(me);
            }, false);

            canvas.addEventListener("touchstart", function (e) {
                mousePos = getTouchPos(canvas, e);
                var touch = e.touches[0];
                var me = new MouseEvent("mousedown", {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(me);
            }, false);

            canvas.addEventListener("touchend", function (e) {
                var me = new MouseEvent("mouseup", {});
                canvas.dispatchEvent(me);
            }, false);

            function getMousePos(canvasDom, mouseEvent) {
                var rect = canvasDom.getBoundingClientRect();
                return {
                    x: mouseEvent.clientX - rect.left,
                    y: mouseEvent.clientY - rect.top
                }
            }

            function getTouchPos(canvasDom, touchEvent) {
                var rect = canvasDom.getBoundingClientRect();
                return {
                    x: touchEvent.touches[0].clientX - rect.left,
                    y: touchEvent.touches[0].clientY - rect.top
                }
            }

            function renderCanvas() {
                if (drawing) {
                    ctx.moveTo(lastPos.x, lastPos.y);
                    ctx.lineTo(mousePos.x, mousePos.y);
                    ctx.stroke();
                    lastPos = mousePos;
                }
            }

            // Prevent scrolling when touching the canvas
            document.body.addEventListener("touchstart", function (e) {
                if (e.target == canvas) {
                    e.preventDefault();
                }
            }, false);
            document.body.addEventListener("touchend", function (e) {
                if (e.target == canvas) {
                    e.preventDefault();
                }
            }, false);
            document.body.addEventListener("touchmove", function (e) {
                if (e.target == canvas) {
                    e.preventDefault();
                }
            }, false);

            (function drawLoop() {
                requestAnimFrame(drawLoop);
                renderCanvas();
            })();

            function clearCanvas() {
                canvas.width = canvas.width;
            }

            // Set up the UI
            var sigText = document.getElementById("sig-dataUrl");
            var sigImage = document.getElementById("sig-image");
            var clearBtn = document.getElementById("sig-clearBtn");
            var submitBtn = document.getElementById("sig-submitBtn");
            clearBtn.addEventListener("click", function (e) {
                clearCanvas();
                sigText.innerHTML = "Data URL for your signature will go here!";
                sigImage.setAttribute("src", "");
            }, false);
            submitBtn.addEventListener("click", function (e) {
                var dataUrl = canvas.toDataURL();
                sigText.innerHTML = dataUrl;
                sigImage.setAttribute("src", dataUrl);
            }, false);

        })();
    </script>
    <script>

        const phoneInputField = document.querySelector("#PhoneNumber");
        const phoneInput = window.intlTelInput(phoneInputField, {
            preferredCountries: ["in"],
            utilsScript:
                "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });

        const phoneInputField2 = document.querySelector("#SecondPhoneNumber");
        const phoneInput2 = window.intlTelInput(phoneInputField2, {
            preferredCountries: ["in"],
            utilsScript:
                "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });

    </script>
    <script>

        const accountInfoEditBtn = document.querySelector('#account-info-editbtn');
        const accountInfoSubmitBtn = document.querySelector('#account-info-save');
        const accountInfoCancelBtn = document.querySelector('#account-info-cancel');
        const accountInfoInputTags = document.querySelectorAll('.account-info');
        const passwordInput = document.querySelector('#Password');
        const roleList = document.querySelector('#role-list');
        const statusList = document.querySelector('#status-list');
        const resetPassBtn = document.querySelector('#reset-pass');


        accountInfoEditBtn.addEventListener('click', () => {

            accountInfoEditBtn.classList.add('d-none');

            accountInfoSubmitBtn.classList.remove('d-none');
            accountInfoCancelBtn.classList.remove('d-none');
            resetPassBtn.classList.remove('d-none');

            accountInfoInputTags.forEach(input => {
                input.readOnly = false;
            });

            roleList.disabled = false;
            statusList.disabled = false;

            passwordInput.readOnly = true;
        });

        accountInfoCancelBtn.addEventListener('click', () => {

            accountInfoSubmitBtn.classList.add('d-none');
            accountInfoCancelBtn.classList.add('d-none');
            resetPassBtn.classList.add('d-none');

            accountInfoEditBtn.classList.remove('d-none');

            accountInfoInputTags.forEach(input => {
                input.readOnly = true;
            });

            roleList.disabled = true;
            statusList.disabled = true;
        });

        resetPassBtn.addEventListener('click', () => {
            passwordInput.readOnly = false;
            resetPassBtn.classList.add('d-none');
        })


        const physicianInfoEditBtn = document.querySelector('#physician-info-editbtn');
        const physicianInfoSubmitBtn = document.querySelector('#physician-info-save');
        const physicianInfoCancelBtn = document.querySelector('#physician-info-cancel');
        const physicianInfoInputTags = document.querySelectorAll('.physician-info');
        const physicianInfoCheckboxes = document.querySelectorAll('.physician-info-checkbox');


        physicianInfoEditBtn.addEventListener('click', () => {

            physicianInfoEditBtn.classList.add('d-none');

            physicianInfoSubmitBtn.classList.remove('d-none');
            physicianInfoCancelBtn.classList.remove('d-none');

            physicianInfoInputTags.forEach(input => {
                input.readOnly = false;
            });

            physicianInfoCheckboxes.forEach(checkbox => {
                checkbox.disabled = false;
            });

        });

        physicianInfoCancelBtn.addEventListener('click', () => {

            physicianInfoSubmitBtn.classList.add('d-none');
            physicianInfoCancelBtn.classList.add('d-none');

            physicianInfoEditBtn.classList.remove('d-none');

            physicianInfoInputTags.forEach(input => {
                input.readOnly = true;
            });

            physicianInfoCheckboxes.forEach(checkbox => {
                checkbox.disabled = true;
            })
        });


        const billingInfoEditBtn = document.querySelector('#billing-info-editbtn');
        const billingInfoSubmitBtn = document.querySelector('#billing-info-save');
        const billingInfoCancelBtn = document.querySelector('#billing-info-cancel');
        const billingInfoInputTags = document.querySelectorAll('.billing-info');
        const regionList = document.querySelector('#region-list');


        billingInfoEditBtn.addEventListener('click', () => {

            billingInfoEditBtn.classList.add('d-none');

            billingInfoSubmitBtn.classList.remove('d-none');
            billingInfoCancelBtn.classList.remove('d-none');

            billingInfoInputTags.forEach(input => {
                input.readOnly = false;
            });

            regionList.disabled = false;
        });

        billingInfoCancelBtn.addEventListener('click', () => {

            billingInfoSubmitBtn.classList.add('d-none');
            billingInfoCancelBtn.classList.add('d-none');

            billingInfoEditBtn.classList.remove('d-none');

            billingInfoInputTags.forEach(input => {
                input.readOnly = true;
            });

            regionList.disabled = true;
        });


        const profileInfoEditBtn = document.querySelector('#profile-info-editbtn');
        const profileInfoSubmitBtn = document.querySelector('#profile-info-save');
        const profileInfoCancelBtn = document.querySelector('#profile-info-cancel');
        const profileInfoInputTags = document.querySelectorAll('.profile-info');
        const profileInfoUploads = document.querySelectorAll('.profile-info-upload');
        const profileInfoUploadLables = document.querySelectorAll('.upload-label');


        profileInfoEditBtn.addEventListener('click', () => {

            profileInfoEditBtn.classList.add('d-none');

            profileInfoSubmitBtn.classList.remove('d-none');
            profileInfoCancelBtn.classList.remove('d-none');

            profileInfoInputTags.forEach(input => {
                input.readOnly = false;
            });

            profileInfoUploads.forEach(input => {
                input.disabled = false;
            });

            profileInfoUploadLables.forEach(label => {
                label.classList.add('bg-white');
            });
        });

        profileInfoCancelBtn.addEventListener('click', () => {

            profileInfoSubmitBtn.classList.add('d-none');
            profileInfoCancelBtn.classList.add('d-none');

            profileInfoEditBtn.classList.remove('d-none');

            profileInfoInputTags.forEach(input => {
                input.readOnly = true;
            });

            profileInfoUploads.forEach(input => {
                input.disabled = true;
            });

            profileInfoUploadLables.forEach(label => {
                label.classList.remove('bg-white');
            });

        });

    </script>

    <script>
        const photoInput = document.getElementById('Photo');
        const signatureInput = document.getElementById('Signature');
        const photoSpan = document.getElementById('photoSpan');
        const signatureSpan = document.getElementById('signatureSpan');

        photoInput.addEventListener('change', (event) => {
            const photoFile = event.target.files[0];
            if (photoFile) {
                photoSpan.textContent = photoFile.name;
            } else {
                photoSpan.textContent = "Select File"; 
            }
        });

        signatureInput.addEventListener('change', (event) => {
            const signatureFile = event.target.files[0];
            if (signatureFile) {
                signatureSpan.textContent = signatureFile.name;
            } else {
                signatureSpan.textContent = "Select File"; 
            }
        });
    </script>
}

